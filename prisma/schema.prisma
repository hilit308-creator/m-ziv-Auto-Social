// Prisma Schema for M-Ziv Auto Social
// Database: SQLite (lightweight, no external dependencies)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Brand Profile - הגדרות קבועות של העסק
model BrandProfile {
  id                String   @id @default(cuid())
  name              String   @default("M-Ziv")
  businessType      String   @default("ייעוץ עסקי")
  tone              String   @default("מקצועי וחם")
  language          String   @default("עברית")
  targetAudience    String   @default("בעלי עסקים קטנים ובינוניים")
  defaultCta        String   @default("צרו קשר לייעוץ ראשוני")
  emojiLevel        String   @default("low") // none, low, medium
  maxWordsInstagram Int      @default(50)
  maxWordsFacebook  Int      @default(100)
  maxWordsTiktok    Int      @default(30)
  maxWordsLinkedin  Int      @default(150)
  maxWordsYoutube   Int      @default(200)
  brandedHashtags   String   @default("#MZiv,#יועציםעסקיים") // comma separated
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Post - פוסט שנוצר
model Post {
  id              String        @id @default(cuid())
  topic           String        // נושא הפוסט
  voiceNotes      String?       // תמליל הערות קוליות
  status          String        @default("draft") // draft, scheduled, published, failed
  
  // תוכן לכל פלטפורמה (JSON string)
  instagramCaption   String?
  instagramHashtags  String?    // comma separated
  facebookCaption    String?
  tiktokCaption      String?
  tiktokHashtags     String?
  youtubeTitle       String?
  youtubeDescription String?
  youtubeTags        String?
  linkedinCaption    String?
  
  // מדיה
  mediaUrl        String?
  mediaType       String?       // image, video
  
  // תזמון
  scheduledAt     DateTime?
  publishedAt     DateTime?
  
  // מטא
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // גרסאות
  versions        PostVersion[]
}

// PostVersion - היסטוריית שינויים
model PostVersion {
  id              String   @id @default(cuid())
  postId          String
  post            Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  versionNumber   Int
  command         String?  // הפקודה ששימשה לשכתוב (shorter, more_professional, etc.)
  
  // תוכן הגרסה
  instagramCaption   String?
  instagramHashtags  String?
  facebookCaption    String?
  tiktokCaption      String?
  tiktokHashtags     String?
  youtubeTitle       String?
  youtubeDescription String?
  youtubeTags        String?
  linkedinCaption    String?
  
  createdAt       DateTime @default(now())
}

// ContentIdea - רעיונות לתוכן יומי
model ContentIdea {
  id          String   @id @default(cuid())
  topic       String
  description String?
  category    String?  // tips, story, promo, educational
  used        Boolean  @default(false)
  usedAt      DateTime?
  createdAt   DateTime @default(now())
}

// User - משתמש במערכת
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String   // hashed
  name          String?
  plan          String   @default("free") // free, pro, enterprise
  planExpiresAt DateTime?
  
  // Brand settings
  brandName     String?
  brandTone     String?
  brandColors   String?  // JSON array
  brandLogo     String?
  
  // Relations
  socialAccounts SocialAccount[]
  templates      AITemplate[]
  auditLogs      AuditLog[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// SocialAccount - חשבון רשת חברתית מחובר
model SocialAccount {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  platform      String   // instagram, facebook, twitter, linkedin, tiktok, youtube
  accountId     String   // Platform's account ID
  accountName   String?  // Display name
  accessToken   String
  refreshToken  String?
  tokenExpiry   DateTime?
  isActive      Boolean  @default(true)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([userId, platform, accountId])
}

// AITemplate - תבניות AI לפלטפורמות
model AITemplate {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name        String
  platform    String   // instagram, facebook, twitter, linkedin, tiktok, youtube, all
  category    String   // promo, educational, story, engagement, announcement
  template    String   // The actual prompt template
  variables   String?  // JSON array of variable names
  isDefault   Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// AuditLog - לוג פעולות
model AuditLog {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  action      String   // login, logout, create_post, publish, delete, etc.
  resource    String?  // post, template, account, etc.
  resourceId  String?
  details     String?  // JSON with additional info
  ipAddress   String?
  userAgent   String?
  
  createdAt   DateTime @default(now())
}
